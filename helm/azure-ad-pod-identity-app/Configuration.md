# Configuration

The following table lists the configurable parameters of the azure-ad-pod-identity chart, its dependencies and default values.

| Parameter                        | Description                                        | Default           |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------- | ----------------- |
| `nameOverride`                           | String to partially override aad-pod-identity.fullname template with a string (will prepend the release name)                                                                                                                                                                                                                 | `""`                                                           |
| `fullnameOverride`                       | String to fully override aad-pod-identity.fullname template with a string                                                                                                                                                                                                                                                     | `""`                                                           |
| `image.registry`                       | Image repository                                                                                                                                                                                                                                                                                                              | `mcr.microsoft.com/k8s/aad-pod-identity`                       |
| `image.pullPolicy`                       | Image pull policy                                                                                                                                                                                                                                                                                                             | `Always`                                                       |
| `installMICException`                    | When NMI runs on a node where MIC is running, then MIC token request call is also intercepted by NMI. MIC can't get a valid token to initialize and then assign the identity. Installing an exception for MIC would ensure all token requests for MIC pods directly go to IMDS and not go through the pod-identity validation | `true`                                                         |
| `adminsecret.cloud`                      | Azure cloud environment name                                                                                                                                                                                                                                                                                                  | ` `                                                            |
| `adminsecret.subscriptionID`             | Azure subscription ID                                                                                                                                                                                                                                                                                                         | ` `                                                            |
| `adminsecret.resourceGroup`              | Azure resource group                                                                                                                                                                                                                                                                                                          | ` `                                                            |
| `adminsecret.vmType`                     | `standard` for normal virtual machine nodes, and `vmss` for cluster deployed with a virtual machine scale set                                                                                                                                                                                                                 | ` `                                                            |
| `adminsecret.tenantID`                   | Azure service principal tenantID                                                                                                                                                                                                                                                                                              | ` `                                                            |
| `adminsecret.clientID`                   | Azure service principal clientID                                                                                                                                                                                                                                                                                              | ` `                                                            |
| `adminsecret.clientSecret`               | Azure service principal clientSecret                                                                                                                                                                                                                                                                                          | ` `                                                            |
| `mic.image.name`                              | MIC image name                                                                                                                                                                                                                                                                                                                | `mic`                                                          |
| `mic.image.tag`                                | MIC image tag                                                                                                                                                                                                                                                                                                                 | `1.6.1`                                                        |
| `mic.priorityClassName`                  | MIC priority class |                                                                |
| `mic.logVerbosity`                       | Log level. Uses V logs (glog)                                                                                                                                                                                                                                                                                                 | `0`                                                            |
| `mic.resources`                          | Resource limit for MIC                                                                                                                                                                                                                                                                                                        | `{}`                                                           |
| `mic.podAnnotations`                     | Pod annotations for MIC                                                                                                                                                                                                                                                                                                       | `{}`                                                           |
| `mic.tolerations`                        | Affinity settings                                                                                                                                                                                                                                                                                                              | `{}`                                                           |
| `mic.affinity`                            | List of node taints to tolerate                                                                                                                                                                                                                                                                                               | `[]`                                                           |
| `mic.leaderElection.instance`            | Override leader election instance name                                                                                                                                                                                                                                                                                        | `hostname`                   |
| `mic.leaderElection.name`                | Override leader election name                                                                                                                                                                                                                                                                                                 | `aad-pod-identity-mic`       |
| `mic.leaderElection.duration`            | Override leader election duration                                                                                                                                                                                                                                                                                             | `15s`                        |
| `mic.probePort`                          | Override http liveliness probe port                                                                                                                                                                                                                                                                                           | `8080`                        |
| `mic.syncRetryDuration`                  | Override interval in seconds at which sync loop should periodically check for errors and reconcile                                                                                                                                                                                                                            | `3600s`                      |
| `mic.immutableUserMSIs`                  | List of  user-defined identities that shouldn't be deleted from VM/VMSS.                                                                                                                                                                                                                                                       | |
| `mic.cloudConfig`                         | The cloud configuration used to authenticate with Azure                                                                                                                                                                                                                                                                        | `/etc/kubernetes/azure.json` |
| `mic.updateUserMSIMaxRetry`              | The maximum retry of UpdateUserMSI call in case of assignment errors                                                                                                                                                                                                                                                          | `2`                          |
| `mic.updateUserMSIRetryInterval`         | The duration to wait before retrying UpdateUserMSI (batch assigning/un-assigning identity from VM/VMSS) in case of errors                                                                                                                                                                                                     | `1s`                         |
| `nmi.image.name`                              | NMI image name                                                                                                                                                                                                                                                                                                                | `nmi`                                                          |
| `nmi.image.tag`                                | NMI image tag                                                                                                                                                                                                                                                                                                                 | `1.6.1`                                                        |
| `nmi.priorityClassName`                  | NMI priority class                                                                                                                                                                                                                                           |                                                                |
| `nmi.resources`                          | Resource limit for NMI                                                                                                                                                                                                                                                                                                        | `{}`                                                           |
| `nmi.podAnnotations`                     | Pod annotations for NMI                                                                                                                                                                                                                                                                                                       | `{}`                                                           |
| `nmi.tolerations`                        | Affinity settings                                                                                                                                                                                                                                                                                                              | `{}`                                                           |
| `nmi.affinity`                            | List of node taints to tolerate                                                                                                                                                                                                                                                                                               | `[]`                                                           |
| `nmi.ipTableUpdateTimeIntervalInSeconds` | Override iptables update interval in seconds                                                                                                                                                                                                                                                                                  | `60`                                                           |
| `nmi.probePort`                          | Override http liveliness probe port                                                                                                                                                                                                                                                                                           | `8080`                             |
| `nmi.retryAttemptsForCreated`            | Override number of retries in NMI to find assigned identity in CREATED state                                                                                                                                                                                                                                                   |  `16`                              |
| `nmi.retryAttemptsForAssigned`           | Override number of retries in NMI to find assigned identity in ASSIGNED state                                                                                                                                                                                                                                                  |  `4`                               |
| `nmi.findIdentityRetryIntervalInSeconds`  | Override retry interval to find assigned identities in seconds                                                                                                                                                                                                                                                                 |  `5`                               |
| `rbac.enabled`                           | Create and use RBAC for all aad-pod-identity resources                                                                                                                                                                                                                                                                        | `true`                                                         |
| `rbac.allowAccessToSecrets`              | NMI requires permissions to get secrets when service principal (type: 1) is used in AzureIdentity. If using only MSI (type: 0) in AzureIdentity, secret get permission can be disabled by setting this to false.                                                                                                              | `true`                                                         |
| `azureIdentities`                        | List of azure identities and azure identity bindings resources to create                                                                                                                                                                                                                                                      | `[]`                                                           |
| `installCRDs`                            | If true, install necessary custom resources                                                                                                                                                                                                                                                                                   | `false`                                                        |
